리눅스 마스터
1급
실기 공부
■ User 관리 (명령어, 설정파일 등)
가. 사용자 계정생성
  1. useradd
	ㄱ. useradd marine –d /home/terran/marine –g terran
	   - 마린 사용자 생성하면서, 그룹 설정 및 디렉토리 설정
	ㄴ. useradd –D 
	   - /etc/default/useradd 관련 설정값 출력
	       # useradd –D
		GROUP=100
		   - 해당 GID를 사용하는 그룹을 찾아 해당 그룹으로 설정
		HOME=/home
		   - 홈 디렉토리
		INACTIVE=-1
		   - passwd 사용 기한 설정
		EXPIRE=
		   - 계정 유효기간
		SHELL=/bin/bash
		   - 셸 부여
		SKEL=/etc/skel
		   - 사용자 생성 시 부여 할 디렉토리와 파일이 들어있는 위치
		CREATE_MAIL_SPOOL=yes
		   - 메일파일 생성할 것인지 지정
나. 사용자 계정 정의
  1. /etc/login.def
	ㄱ. 메일 디렉토리, passwd 관련 설정, UID, GID, 홈 디렉토리 생성, 기본 UMASK 값, passwd 적용 암호화 알고리즘 정의된 파일
  2. /etc/skel
	ㄴ. 해당 디렉토리 안의 파일을 생성된 계정에도 추가해줌

다. 사용자 계정 관리
  1. usermod
	ㄱ. Shell, 홈, 그룹, UID, GID 등 변경
	   - d: 홈디렉토리 변경
	   - m: 홈 디렉토리 변경 시 기존 파일, 디렉토리도 이동
	   - g: 사용자 그룹 변경
	   - s: 사용자 셸 변경
	   - u: 사용자 UID 변경
	   - G: 그룹 추가로 속하게 함
	   - l(엘): 아이디 변경
  2. userdel
	ㄱ. 사용자 계정 삭제 명령어
	   - r: 계정 및 사용자 계정 홈 디렉토리 및 모든 내용 제거
  3. passwd
	ㄱ. 사용자 계정 패스워드 관리
	   - 이건 옵션 외우기 싫어용 man passwd 합시다
  4. chage [option] 사용자 계정
	   - 이것도 man chage 합시다
라. 그룹 생성
  1. groupadd
	ㄱ. 그룹 생성하는 명령어, 옵션 쓰면 GID 부여 가능
마. 그룹 관리
  1. groupmod
	ㄱ. 그룹명이나 GID 변경
	   - n: 그룹명 변경, groupmod –n (변경될 그룹명) (변경할 그룹명)
	   - g: GID 변경, groupmod –g 555 (그룹명) 
  2. groupdel 
	ㄱ. 그룹 삭제
  3. gpasswd
	ㄱ. 그룹 패스워드, 관리자 지정, 사용자 추가, 제거
	   - A: 관리자 지정
	   - a: 사용자 추가
	   - d: 사용자 제거
	   - r: 그룹 패스워드 제거
  4. newgrp
	ㄱ. 사용자가 일시적으로 1차그룹 변경
■ 특수 권한
가. 일부 권한을 위한 특별한 권한이 있는데, 다음과 같이 세 가지로 분류
  1. Set-UID
	ㄱ. 해당 파일을 실행하는 동안  해당 파일의 소유자 권한으로 인식함.
	   - 소유자 권한 부분의 x자리에 s로 표기, 실행권한이 없는 파일이면 S
  2. Set-GID
	ㄱ. 해당 파일을 소유한 그룹 권한으로 인식함. 이 권한이 설정된 디렉토리 내에서 파일 혹은 디렉토리를 생성하면 상위 디렉토리의 소유 그룹 권한으로 생성됨. 그룹 소유권 부분에서 x자리에 s로 나타내며, 실행권한이 없으면 S
  3. Sticky-Bit
	ㄱ. 공유 디렉토리로 사용됨, /tmp가 대표적인 디렉토리이며, 본인이 생성한 파일만 삭제할 수 있음. other 계층 권한 부분에 t로 표기, 실행권한이 없을 때, 즉 그룹 공유모드 사용된 경우는 T로 표기
  4. umask 값
	ㄱ. Set-UID: 4xxx
	ㄴ. Set-GID: 2xxx
	ㄷ. Sticky-Bit: 1xxx

■ 링크
가. 하드링크와 심볼릭 링크
  1. 하드링크
	ㄱ. 파일에만 부여할 수 있음
	ㄴ. 특징
	   - 원본과 링크파일의 아이노드 번호가 같다.
	   - 원본과 링크파일의 내용이 같음, 수정해도 같이 수정됨
	   - 원본 삭제 시 링크파일은 삭제 안 됨
  2. 심볼릭  링크
	ㄱ. 파일 및 디렉토리에 부여 가능
	   - 아이노드의 번호가 다르다.
	   - 수정 시 같이 반영됨
	   - 원본 삭제 시 링크파일 암것도 몬함(걍 바로가기 느낌)

■ 파일시스템 관리 및 복구
가. 파일시스템 생성
  1. 용량 300GB인 SATA 디스크 추가 장착하여 100GB 할당 후 /backup으로 마운트
	ㄱ. fdisk –l 명령으로 device 확인
	   - Disk /dev/sdb: 320GB
	ㄴ. fdisk /dev/sdb 명령으로 용량 할당
	ㄷ. 시스템 재부팅 or partprobe 수행
	ㄹ. 파일시스템 생성
	   - mkfs.xfs /dev/sdb1 # xfs 파일시스템으로 생성
	ㅁ. 마운트할 디렉토리 생성 
	   - mkdir /backup
	ㅂ. 마운트
	   - mount –t xfs /dev/sdb1 /backup 
	ㅅ. 마운트 및 용량 확인
	ㅇ. fstab 파일 등록
	   - /dev/sdb1 	/backup 	xfs 	defaults	   1   1
나. swap 파티션 생성
  1. 스왑 파일 생성하기
	ㄱ. dd 명령을 이용, 원하는 파일 크기만큼 스왑 파일 생성
	   - # dd if=/dev/zero of=/swap-file bs=1k count=1024000
	ㄴ. 스왑파일 생성
	   - mkswap /swap-file
	ㄷ. 스왑파일 활성화
	   - swapon /swap-file
	ㄹ. 부팅 시마다 사용하려면 /etc/fstab에 등록
	   - /swap-file     swap     swap     default    0   0 
  2. 스왑 파티션 생성하기
	ㄱ. fdisk 명령을 이용하여 스왑 파티션 생성
	   - fdisk /dev/sdb
	ㄴ. 스왑 파티션 생성
	   - /mkswap –c /dev/sdb2
	ㄷ. 스왑 파티션 활성화
	   - swapon /dev/sdb2
	ㄹ. 부팅 시마다 사용하려면 /etc/fstab에 등록
	   - /dev/sdb2    swap   swap   default   0   0
■ 디스크 쿼터 
가. 개요
  1. 특정 사용자가 디스크 용량 모두 사용하는 것을 방지하기 위해 디스크 사용량 제한을 두는 것, 이를 디스크 쿼터라고 한다.
나. 사용 명령어
  1. xfs_quota
	ㄱ. XFS 
	   - 파일시스템 쿼터 관리 명령어
	   - xfs_quota –x –c ‘limit bsoft=100m bhard=110m joon’ /home/
		# 용량 제한
	   - xfs_quota –x –c ‘limit isoft=1000 ihard=1100 joon’ /home
		# 파일 개수 제한
	ㄴ. edquota
	   - 사용자나 그룹에 쿼터 설정, 기본단위 KB, 10MB면 10,000 입력
	ㄷ. repquota 
	   - 파일 시스템에 설정된 쿼터 정보 출력
	ㄹ. quota
	   - 사용자나 그룹 단위로 쿼터 설정 정보 출력
	ㅁ. setquota
	   - 쿼터 설정하는 명령, vi 편집기 대신 직접 설정
	   - setquota –u yuloje 10000 11000 0 0 /home/
		# 용량제한 soft 10mb, hard 11mb, inode 제한 설정x
다. 사용자 쿼터 설정
  1. /etc/fstab 설정
	ㄱ. /etc/fstab에서 /home/의 4번째 필드 쿼터 설정옵션에 uqota 추가
	   - UUID=1234asdgzxcv /home xfs default,uqota 0 0
	ㄴ. /home 재마운팅
	   - umount /home; mount –a
	ㄷ. 확인
	   - mount | grep /home
		# /dev/sda3 on /home type xfs (rw,real~~~,usrquota)
	ㄹ. 사용자에 대한 쿼터 설정
	   - xfs_quota –x –c ‘limit bsoft=100m bhard=110m alin’ /home
	ㅁ. repquota /home
라. 그룹 쿼터 설정
  1. /etc/fstab 설정
	ㄱ. 4번째 필드에 gquota 추가
	   - UUID=1234asdgzxcv /home xfs default,gqota 0 0
	ㄴ. /home 재마운팅
	ㄷ. umount /home; mount –a
	ㄹ. 적용 확인
	   -  mount | grep /home
		# /dev/sda3 on /home type xfs (rw,relatime,~~~,grpquota)
	ㅁ. 쿼터 설정 확인
	   - requota –g /home

■ cron 사용방법
가. 명령어
  1. crontab –l
	- crontab에 설정된 내용 출력
  2. crontab –e
	- crontab 내용 작성 및 수정
  3. crontab –r
	- crontab 내용이 저장된 파일 삭제
  4. crontab –u
	- 사용자 지정
  5. crontab –i –r –u haechan
	- 해찬의 cron파일 삭제
나. cron 사용자 제한
  1. /etc/cron.allow
	ㄱ. /etc/cron.deny 파일 있든 없든 해당 파일에 등록된 사용자만 사용 가능
  2. /etc/cron.deny
	ㄴ. /etc/cron.allow 파일이 존재하지 않을 시 해당 파일에 등록된 사용자는 사용이 불가능	
  3. 모두 없을 경우 root만 사용 가능

■ 프로세스 관리
가. 명령어 및 사용 방법
  1. killall
	ㄱ. killall [process]
	   - 같은 데몬의 여러 프로세스를 한 번에 종료할 때 사용
	ㄴ. killall –HUP httpd
	   - httpd 데몬들 재시작(연결 담당하는 httpd 프로세스)
	ㄷ. killall –9 –u posein
	   - 해당 사용자 작업 전부 종료
  2. nice
	ㄱ. process 우선순위 변경, 프로세스 명으로 NI 값 설정할 때 사용
	   - 기본값은 0이고, 지정가능 범위는 –20~19, 작을수록 우선순위가 높음
	   - 기존 설정값에 증감하는 방식
		# nice –10(증가) nice —10(감소)
		# nice –10 bash
  3. renice
	ㄱ. process 우선순위 변경, 프로세스 번호로 NI 값 지정할 때 사용
	   - 기본적으로 nice와 유사하지만, 직접 지정한다.
		# renice –20 3902
  4. pgrep 
	ㄱ. 프로세스명으로 PID 출력
  5. pkill
	ㄱ. 프로세스 명으로 종료시키거나, 유저 지정하여 유저 프로세스 종료

■ 소프트웨어 설치 및 관리
가. rpm
  1. 설치 및 갱신, 제거, 질의 등 관리 가능
	ㄱ. 설치옵션
	   - rpm -i ~~~.rpm
		# 해당 rpm 패키지 설치
	   - rpm Uvh ~~~.rpm
		# 해당 rpm 업그레이드 설치
	   - rpm Fvh ~~~.rpm
		# 해당 rpm 업데이트
	ㄴ. 제거 옵션
	   - rpm -e httpd --nodeps
		# httpd 패키지 제거 및 의존성 패키지도 제거
	ㄷ. 질의모드
	   - rpm -q httpd
		# 패키지 이름과 버전 표시
	   - rpm -qa
		# 모든 패키지 정보 출력
	   - rpm -qi httpd
		# 패키지 자세한 정보 출력
	   - rpm -ql httpd
		# 해당 패키지가 설치한 파일 목록 출력
	   - rpm -qc httpd
		# 패키지 관련 환경설정 파일이나 데몬 스크립트 출력
	   - rpm -qlp 
		# 입력한 패키지에서 설치되는 파일 정보 출력
	   - rpm -qip 
		# 입력한 패키지 파일에 대한 정보 출력
	ㄹ. 검증모드
	   - rpm -Va
		# 설치된 모든 패키지 검증
	   - rpm -V vsftpd
		# 해당 패키지 검증
나. yum
  1. rpm 기반의 시스템에서 패키지 손쉽게 설치 및치 및 자동 업데이트 수행
  2. 환경설정파일
	ㄱ. 환경설정파일 /etc/yum.conf
	ㄴ. repository /etc/yum.repos.d
  3. 명령어
	ㄱ. yum install
		# 설치
	ㄴ. yum info
		# 패키지 정보 출력
	ㄷ. yum remove 
		# 패키지 삭제
	ㄹ. yum list
		# 패키지 출력
	ㅁ. yum history	
		# yum 관련 작업 이력 출력
■ 소스 코드 컴파일
가. 소스 설치 개요
  1. 리눅스 소스 프로그램 설치 시 다음과 같이 5단계를 거침
	ㄱ. 압축풀기
	ㄴ. 디렉터리 이동
  	ㄷ. configure
  	ㄹ. make
  	ㅁ. make install
	   - 해당 작업을 수행하기 위해 tar, gcc, make 등 응용프로그램 필요
나. 주요 3단계
  1. configure
	- 소스 프로그램의 환경 설정을 하는 스크립트이며, 사용자들이 자신의 환경에 맞도록 손쉽게 수정하도록 제공되는 스크립트. 이 스크립트를 통해 적당한 소프트웨어 패키지가 생성되도록 Makefile을 만든다. 
  2. make
	- Makefile을 읽고 프로그램과 라이브러리를 자동으로 빌드하고, 실행파일을 만듦.
  3. make install
	- 컴파일된 실행파일을 지정한 속성으로 지정한 디렉토리에 설치
다. cmake
  1. configure와 make의 과정을 수행하지 않고 지정 운영체제에 맞는 make 파일을 생성함.
라. gcc
  1. 컴파일러 모음
	ㄱ. c언어로 작성할 파일을 gcc로 컴파일하면 a.out라는 실행파일이 생성됨
	ㄴ. 사용법
	   - gcc -o sum sum.c
		# sum.c를 컴파일하여 sum이라는 실행파일 생성
	   - gcc -c sum.c
		# sum.c를 컴파일하여 오브젝트 파일 생성, 기본은 sum.o로 생성
	   - gcc -o LinkedList LinkedList.c Test_LinkedList.c
		# c 파일 두개를 컴파일하여 앞의 실행파일 생성
마. Makefile 구조
  # lin : start.o end.o main.o
  # 		gcc -o lin start.o end.o main.o
  # start.o : start.c
  #		gcc -c start.c
  # end.o : end.c
  # 		gcc -c end.c
  # main.o : main.c
  # 		gcc -c main.c
  # clean : 
		rm -f *.o lin
 
■ tar 사용법
가. 명령어
  1. 압축
	ㄱ. c 옵션을 사용하여 압축
	   - tar cvf posein.tar *.c
		# *.c의 파일을 posein.tar로 묶고, 진행 결과 출력
		# v는 묶는 파일들을 보여주고, f는 파일 지정
	ㄴ. r 옵션을 사용하여 추가 압축
	   - tar rvf posein.tar jalin.txt yuloje.c
		# r 옵션을 사용하여 기존의 tar 파일에 추가로 압축해줌.
  2. 압축 풀기
	ㄱ. x 옵션을 사용하여 압축 해제
	   - tar xvf posein.tar
  3. 다른 압축파일 풀기
	ㄱ. gzip 풀기
	   - tar zxvf posein.tar
	ㄴ. bzip2 풀기
	   - tar jxvf posein.tar
	ㄷ. xz 풀기
	   - tar Jxvf posein.tar
■ 공유 라이브러리
가. /lib
  1. ls, mv 등과 같은 기본 명령어 및 시스템 연관 라이브러리 위치
나. /usr/lib
  1. 응용프로그램과 관련된 라이브러리 위치
다. 특정 디렉터리 위치를 라이브러리 관련 디렉토리로 등록
  1. /etc/ld.so.conf 파일 사용
	# include /경로/*.conf
  2. ld.so.conf 파일 내용 갱신
   - ldconfig 명령어 사용

■ 모듈 관리
가. /lib/modules/커널버전/kernel 디렉터리 안에 생성되어 있음.
나. 관련 명령어
  1. lsmod
	ㄱ. 적재된 모듈 정보 출력, 사용중인 모듈 순으로 출력
  2. insmod
	ㄱ. 커널에 모듈 적재하는 명령
	   - 해당 모듈 파일이 존재하는 디렉터리까지 이동 후 사용, 의존성이 있는 모듈이면 적재 불가능
  3. rmmod
	ㄱ. 모듈 제거 명령, 사용중이면 제거 불가능
  4. modprobe
	ㄱ. 커널에 모듈 적재하거나 제거하는 명령, 얘가 제일 중요할 듯
	ㄴ. 단일모듈, 의존성 있는 여러 모듈, 특정 디렉터리 모든 모듈 적재 가능
	ㄷ. 최상위 모듈 디렉토리의 modules.dep 파일 참고하여 모듈 의존성 해결
  	ㄹ. 사용법
	   -  modprobe -r ip6table_filter
		# 모듈 제거하면서 관련 모듈도 제거
	   - modprobe ip6table_filter
		# 모듈 적재하면서 필요한 의존 모듈도 같이 적재
  5. modinfo
	ㄱ. 모듈 파일 정보 출력
다. 관련 설정파일
  1. /etc/modprobe.d /lib/modprob.d디렉터리 안의 .conf의 모든 파일 인식 
■ 프린터하기
가. BSD 계열 
  1. 명령어	
	ㄱ. lpr
	   - 프린터 작업 요청
		# lpr -# 2 -P {printer name} test.txt
		   - # 2: 프린트할 수
		   - -P 프린터 이름
	ㄴ. lpq 
	   - 프린터 큐 작업 목록 출력
	ㄷ. lprm
	   - 큐에서 대기중인 작업 삭제
		# lprm 3 
		   - 작업번호 3번의 작업 취소
		# lprm -
		   - 현재 사용자의 모든 인쇄작업 취소
나. System v 계열
  1. 명령어
	ㄱ. lp
	   - 인쇄 명령, lpr과 비슷
		# lp /etc/passwd
		# lp -n 2 /etc/passwd
		   - n은 개수
	ㄴ. lpstat
	   - 프린터 큐 상태 출력
	   - -p 옵션으로 프린터 상태 출력
	ㄷ. cancel
	   - 프린트 작업 취소
		# cancel {요청ID}
		# cancel -a(all)
■ LVM 생성하기
가. 조건
  1. 약 1GB씩 할당된 /dev/sdb1, /dev/sdb2 이용하여 lvm0 vg 생성
  2. 1.2GB /ldata1, 800MB /ldata2로 구성
나. 1.2GB /ldata1 생성하기
  1. fdisk로 파티션 생성 및 속성 변경
	ㄱ. fdisk /dev/sdb 실행
	   - p 입력으로 정보 출력
	   - t 입력 후 파티션 선택 후 8e 입력
	   	# p -> t -> 1 -> 8e, t -> 2 -> 8e -> w
  2. PV 생성
	ㄱ. pvcreate /dev/sdb1, pvcreate /dev/sdb2
  3. PV를 특정 VG(lvm0)으로 구성
	ㄱ. vgcreate lvm0 /dev/sdb1 /dev/sdb2
  4. 생성된 VG 확인
	ㄱ. vgdisplay -v
  5. LV 생성
	ㄱ. lvcreate -L 1200M -n ldata1 lvm0
  6. LV 생성정보 확인
	ㄱ. lvscan
  7. VG 사용량 정보 확인
	ㄱ. vgdisplay -v
  8. 파일시스템 생성
	ㄱ. mkfs.xfs /dev/lvm0/ldata1
  9. 마운트 디렉터리 생성 
	ㄱ. mkdir /ldata1
  10. 마운트
	ㄱ. mount -t xfs /dev/lvm0/ldata1 /ldata1
  11. df 명령으로 생성 확인
  12. fstab에 작성
	ㄱ. /dev/lvm0/ldata1	/ldata1		xfs	defaults		0  0
다. 800MB /ldata2 생성하기
  1. 남은 공간 확인
	ㄱ. vdisplay -v | tail 11
	   - # PV Name		/dev/sdb2
	   - # Total PE / Free PE	249/198
  2. LV 생성
	ㄱ. lvcreate -l 198 -n ldata2 lvm0
  3. LV 생성 정보 확인
	ㄱ. lvscan
  4. 파일시스템 생성
	ㄱ. mkfs.xfs /dev/lvm0/ldata2
  5. 마운트할 디렉토리 생성
	ㄱ. mkdir /ldata2
  6. 마운트 실행 및 확인
	ㄱ. mount -t xfs /dev/lvm0/ldata2 /ldata2
	ㄱ. df
  7. fstab 등록
	ㄱ. /dev/lvm0/data2		/ldata2		xfs	defaults		0 0

■ 3GB 디스크로 기존 LVM 확장
가. /ldata1 영역 1GB 증설
  1. 추가된 하드를 PV로 생성
	ㄱ. pvcreate /dev/sdb3
  2. VG 확장 및 확인
	ㄱ. vgextend lvm0 /dev/sdb3
	   - lvm0 VG에 포함시키는 것
	ㄴ. vgdisplay -v
	   - /dev/sdb3 포함된지 확인
  3. LV 확장
	ㄱ. umount /dev/lvm0/ldata1
	ㄴ. lvextend -L +1G /dev/lvm0/ldata1
	ㄷ. 증가된 용량 확인
	   - lvscan
	   - lvdisplay
	ㄹ. 파일시스템 크기 늘리기
	   - fsadm resize /dev/lvm0/ldata1
	ㅁ. 증설된 용량 확인
	   - mount -t xfs /dev/lvm0/ldata1 /ldata1
	   - df -h
나. /ldata2 영역 2GB 증설
  1. 남아있는 용량 확인
	ㄱ. vgdisplay -v
	   - 세 번째 디스크에서 Free PE 용량 확인
  2. LV 확장
	ㄱ. umount
	   - umount /dev/lvm0/ldata2
	ㄴ. lvextend로 확장
	   - lvextend -l +493 /dev/lvm0/ldata2
	ㄷ. lvscan, lvdisplay 명령으로 증가된 용량 확인
	   - lvscan
	   - lvdisplay
	ㄹ. 파일시스템 크기 늘리기
	   - fsadm resize /dev/lvm0/ldata2
	ㅁ. 마운트 및 확인
	   - mount -t xfs /dev/lvm0/ldata2 /ldata2
	   - df -h
■ RAID 구성
가. RAID-0 구성
  1. 조건
	ㄱ. 2개 파티션 사용하여 각각 파티션에 2GB씩 할당 후 마운트 후 4GB인지 확인
  2. fdisk로 파티션 생성 및 속성 변경
	ㄱ. fdisk /dev/sdb 실행으로 파티션 생성, 파티션 속성 RAID로 변경
	   - t 입력 후 파티션 1, 2중 선택 후 fd
	ㄴ. 재부팅 | partprobe 수행
	ㄷ. 장치 파일명 확인
	   - fdisk -l /dev/sdb
	ㄹ. RAID 장치 생성
	   - mdadm -C /dev/md0 -l 0 -n 2 /dev/sdb1 /dev/sdb0
		# C(create): RAID 장치 생성
		# l: RAID 레벨값 지정
		# n: device 개수 지정
	ㅁ. 파일시스템 생성
		# mkfs.xfs /dev/md0
	ㅂ. 마운트할 디렉터리 생성
		# mkdir /rdata0
	ㅅ. 마운트	
		# mount -t xfs /dev/md0 /rdata0
	ㅇ. /etc/fstab 등록
		# /dev/md0	/rdata0		xfs	defaults		0  0
	ㅈ. 오류 디스크 확인 및 교체
		# mdadm /dev/md3 -f /dev/sdb10 /dev/sdb13 (장애 발생)
		# mdadm -D /dev/md3 (디바이스 정보 확인)
		# mdadm /dev/md3 -r /dev/sdb8 (디바이스 제거)
		# mdadm /dev/md3 -a /dev/sdb14 (디바이스 추가)
	
■ 로그 설정방법
가. 주요파일
  1. /etc/rsyslog.conf
	ㄱ. syslogd 데몬 환경설정 파일
  2. /etc/sysconfig/rsyslog
	ㄴ. rsyslogd 데몬이 실행과 관련된 옵션이 설정되는 파일
나. 파일 구성
  1. /etc/rsyslog.conf
	ㄱ. facility.priority		action (메시지 종류.등급	행위)
	   - facility 주요 종류
		# auth, security
		   a. login 인증 프로그램 유형 발생 메시지
		# authpriv
		   a. ssh와 같이 인증을 필요한 프로그램 유형이 발생한 메시지
		   b. 사용자 추가 시 발생한 메시지
		# mail
		   a. mail 시스템 발생 메시지
		# uucp
		   a. UUCP(UNIX to UNIX Copy protocol) 시스템 발생 메시지
		# *
		   a. 모든 facility
	   - priority 주요 종류
		# none
		   a. 지정한 facility 제외시킴
		   b. 보통 앞에 다른 facility에 대한 설정 후 ; 뒤에 특정한 facility 제외
		# info
		   a. 통계, 기본 정보 메시지
		# emerg
		   a. 모든 사용자들에게 전달해야 할 위험한 상황
	  
 - action 종류
		# file
		   a. 지정 파일에 로그 기록, 절대경로 기입
		   b. 예) /var/log/messasges
		# @host
		   a. 지정한 호스트로 메시지를 UDP 기반으로 전달
		# @@host
		   a. 지정한 호스트로 메시지를 TCP 기반으로 전달
		# user
		   a. 지정한 사용자가 로그인한 경우 해당 사용자 터미널로 전달
		   b. 예) :omurmsg:*
		   c. 예) :omurmsg:root,posein,yuloje
		# *
		   a. 로그인 되어있는 모든 사용자의 화면으로 전달
		# console, terminal
		   a. 지정한 터미널로 메시지 전달
		   b. 예) /dev/tty2
	ㄴ. 사용 예
	   - *.=crit;kern.none		/var/log/critical
		# 모든 facility가 발생하는 메시지 중 crit 수준의 메시지만 critical에 저장, 
                 커널 관련 로그는 제외
	   - *.emerg		:omusrmsg:*
	   	# 모든 사용자에게 emerg 수준 이상의 메시지 전달
	   - authpriv.*		/dev/tty
		# 인증 관련 로그를 /dev/tty2로 전송
	   - mail.*;mail.!=info		/var/log/maillog
		# mail 관련정보 /var/log/mailog에 저장, info 수준은 제외
	   - uucp,news.crit		/var/log/news
		# uucp, news에서 발생하는 crit 수준 메시지는 저기다 기록
■ logrotate
가. 개요
  1. 로그 파일의 자동 로테이션 기능, 압축 기능, 제거 등 지원
나. 주요 파일
  1. 기본적인 로그 설정
	ㄱ. /etc/logrotate.conf
	   - 기본적인 로그 설정
	   - 주요 항목
		# weekly, daily, monthly, yearly
		   a. 로그파일 로테이트 기간
		# rotate 4
		   a. 최대 4번까지 rotate 하는 설정
		# create
		   a. 로테이트 한 후 비어있는 로그 파일 생성하도록 설정
		# dateext
		   a. rotation으로 생성되는 로그 파일에 날짜 덧붙여서 생성
		   b. maillog-20220420
		# compress
		   a. 로테이트 된 로그파일 압축
		# include /etc/logrotate.d
		   a. 이 디렉터리 안에 설정된 파일 로테이트 적용
		# nomissingok
		   a. 로그 파일이 존재하지 않는 경우에 에러 메시지 출력
		# missingok
		   a. 에러메시지 출력 x, 다음 파일로 이동
	   - 생성 예
		# /var/log/wtmp {
			monthly
			create 0644 root group (허가권 설정)
			   minisize   1M (파일 사이즈가 1M 이상 되면 로테이트)
			rotate 1
		  }
	ㄴ. /etc/logrotate.d
	   - 응용프로그램이 위치하여 로그 파일 관리
다. 로그 주요 파일
  1. /var/log/messages
	ㄱ. 시스템에서 발생하는 표준 메시지 기록
  2. /var/log/secure
	ㄱ. 인증 기반 관련 로그
	ㄴ. login(telnet, ssh), tcp_wrappers, xinetd 관련 로그
  3. /var/log/dmesg
	ㄱ. 부팅 시 출력 로그, 커널 부트 메시지 로그
  4. /var/log/maillog
	ㄱ. sendmail, dovecot 등 메일 관련 작업 기록
  5. /var/log/xferlog
	ㄱ. FTP 접속과 관련된 작업 기록
  6. /var/log/cron
	ㄱ. cron 관련 정보 기록
  7. /var/log/boot.log
	ㄱ. 부팅 시 발생되는 메시지 기록
  8. /var/log/lastlog
	ㄱ. telnet, ssh를 이용하여 접속한 각 사용자의 마지막 정보가 기록되는 파일이며, 바이너리  파일이기 때문에 lastlog라는 명령으로 확인
  9. /var/log/wtmp
	ㄱ. console, telnet, ftp 등 이용하여 접속한 사용자 기록, 시스템 재부팅 정보가 기록되는 파일이며, last라는 명령으로 확인
  10. /var/log/btmp
	ㄱ. wtmp와 반대되는 로그, 접속 실패 기록, lastb라는 명령으로 확인
라. 명령어
  1. last
	ㄱ. last / /var/log/wtmp의 정보 출력
	ㄴ. last posein / posein 사용자의 로그인 정보 출력
	ㄷ. last reboot / 재부팅된 정보 출력
	ㄹ. last -1 reboot / 가장 최근 재부팅한 정보 하나 출력
	ㅁ. last -f /var/log/wtmp.1 / 파일 정보 출력
	ㅂ. last 2 / last tty2로 로긴한 정보 출력
  2. lastlog
	ㄱ. lastlog / 모든 사용자의 최종 로그 기록 출력
	ㄴ. lastlog -u posein / 해당 사용자의 최종 로그 기록 출력
	ㄷ. last -t 3 / 최근 3일 내에 로그인한 사용자의 기록 출력
	ㄹ. last -b 3 / 최근 3일 이전에 로그인한 사용자의 기록 출력

■ sysctl
가. 커널 매개변수(kernel parmeter)의 값을 제어하여 시스템 최적화 하는 명령
  1. /proc/sys 디렉터리에 존재하는 매개변수를 제어하는 명령, 호출 시 /proc/sys는 무시
	ㄱ. /proc/sys/net/ipv4/icmp_echo_ignore_all -> net.ipv4.icmp_echo_ignore_all
나. 사용방법
  1. sysctl [option] 변수
	ㄱ. sysctl -a
	   - 적용된 커널의 매개변수와 값을 전부 출력
	ㄴ. sysctl -p
	   - /etc/sysctl.conf 파일의 내용을 읽고 반영 후 내용 출력
	ㄷ. sysctl -n net.ipv4.icmp_echo_ignore_all
	   - /proc/sys/net/ipv4/icmp_echo_ignore_all의 값 출력
  2. sysctl [option] 변수=값
	ㄱ. sysctl -w net.ipv4.icmp_echo_ignore_all=0
	   - 저 매개변수의 겂을 0으로 설정
  3. sysctl --system
	ㄱ. /etc/sysctl.conf를 비롯하여 커널 매개변수 연관 환경 설정파일 읽어서 적용
	   - /etc/sysctl.conf
		# sysctl 명령어에 의해 읽어들이는 설정 파일, 재부팅 시에도 반영(sysctl -p 사용)

■ ssh
가. ssh 서버 설정
  1. 환경 설정파일: /etc/ssh/sshd_config, 실행 명령은 systemctl start sshd
  2. sshd_config 파일 내용 분석, 솔직히 이거 다 못외우니까 진짜 중요한 것만 외우자
	ㄱ. Port 22
	   - 포트 지정
	ㄴ. Protocol 2
	   - 프로토콜 지정
	ㄷ. AddressFamily any(inet,inet6 지정 가능)
	   - IP 주소 버전 지정
	ㄹ. ListenAddress 0.0.0.0, ListenAddress ::
	   - sshd 데몬이 허가하는 주소를 설정하는 영역ip 대역과 포트 지정 가능
	ㅁ. PermitRootLogin no
	   - root 직접 로그인 불가
	ㅂ. PubkeyAuthentication yes
	   - 공개키를 통한 인증 허가할 것인지 설정
	ㅅ. AuthrizedKeyFilie .ssh/authorized_keys
	   - 공개키 저장 위치
	ㅇ. PermitEmptyPasswords no
	   - 빈 패스워드 접속 불가
	ㅈ. X11Forwarding no
	   - Xwindow 사용 불가
나. ssh 명령어
  1. ssh -l haechan maru0001 
  2. ssh-keygen
	ㄱ. 클라이언트에서 생성된 공개키를 ssh 서버에 복사해주면 passwordless 설정 끝
■ 명령 권한, 파일 세부 권한 설정
가. sudoers
  1. 설정 파일: /etc/sudoers를 편집할 때 사용하는 명령
  2. 설정 방법
	ㄱ. haechan mgmt001=/usr/bin/useradd, /usr/bin/passwd
나. lsattr, chattr, getfacl, setfacl
  1. lsattr
	ㄱ. 속성 확인 시 사용
  2. chattr
	ㄱ. 속성 변경 시 사용, 루트만 가능
	ㄴ. -R 옵션
	   - 하위 디렉터리까지 한 번에 속성 변경 시 사용
  	ㄷ. 속성 부여 방법
	   - chattr +a /var/log/messages
		# 해당 파일 삭제 불가, 추가만 가능
	   - chattr +i /etc/services
		# /etc/services 파일이 삭제나 변경이 불가능
  3. getfacl
	ㄱ. 파일이나 디렉터리에 설정된 접근 권한 리스트 확인
  4. setfacl
	ㄱ. 접근 권한 리스트 설정
	ㄴ. 사용 방법
	   - setafcl -m u::rw joon.txt
		# 해당 파일의 소유자 권한에 rw 권한 부여
	   - setfacl -m u:posein:rw jalin.txt
		# 해당 파일에 posein 사용자에게 rw 권한 부여
	   - setfacl -m g:terran:rwx terran/
		# 테란 그룹에 terran 디렉터리의 권한을 rwx로 부여
	   - setfacl -x u:posein joon.txt
		# joon.txt의 posein 계정의 권한 제거
	   - setfacl -b jalin.txt
		# jalin.txxt의 권한 및 mask 값 제거
■ 백업
가. tar
  1. 전체 백업
	ㄱ. tar cvfp home.tar /home
	   - p옵션: permission 그대로 유지
  2. 증분 백업
	ㄱ. tar -g list -cvfp home1.tar /home
	   - list 파일의 내용을 토대로 증분 백업 시도, 처음엔 전체 백업함
	ㄴ. tar -xvf home1.tar -C /
나. cpio
  1. 많은 양의 데이터에서 tar보다 빠름
  2. 증분 백업 지원하지 않음
  3. 사용법
	ㄱ. find /home | cpio -ocv > home.cpio
	   - /home을 /home.cpio로 백업
	ㄴ. cpio -icdv < home.cpio
	   - home.cpio를 현재 디렉토리에 복원
	ㄷ. cpio -icvt < home.cpio
	   - home.cpio 내용만 확인
	ㄹ. find /home | cpio -ocvF conf.cpio
	   - /home을 conf.cpio로 백업(F는 표준 입출력 전환 기호 대신 사용)
다. dd
  1. 파티션이나 디스크 단위로 백업할 때 사용
  2. 사용법
	ㄱ. dd if=/dev/sda1 of=/dev/sdb1 bs=1k
	   - 블록 사이즈 1KB 단위로 /dev/sda1을 /dev/sdb1로 백업
■ 웹서버(아파치) 
가. httpd.conf(기본적인 설정) 주요 설정
  1. ServerRoot "/etc/httpd/"
	ㄱ. 최상위 디렉터리 지정
  2. Listen 80
	ㄱ. 포트 번호 지정
  3. ServerName "www.ihd.or.kr"
	ㄱ. 도메인명 지정
  4. DocumentRoot "/www"
	ㄱ. 웹 문서 위치 지정
  5. ServerAdmin webadmin@example.com
	ㄱ. 관리자 이메일 주소 지정
  6. DirectoryIndex index.php index.html index.htm
	ㄱ. 인덱스 파일 지정
  7. UserDir www
	ㄱ. 일반 사용자 홈 디렉토리 지정
  8. <Directory />
	    AllowOverride None/AuthConfig
	    Require all denided
	    Order Allow,Deny
	    Deny from all
	    Allow from HOST
	</Directory>
	ㄱ. AllowOverride: 해당 디렉토리에 있는 유저 인증파일인 .htaccess 확인할지 설정
	   - AuthConfig: 사용자 인증 지시자 사용 허락
	ㄴ. Require: 접근 허용 범위 설정(granted 허용, denided 거부)
     	ㄷ. Order에 Deny랑 Allow 순서가 중요한데, 뒤에 나오는 놈은 앞에서 나오는 놈을 무시하고 무조건 적용
나. httpd-userdir.conf
  1. 사용자가 개인 홈페이지 이용하려고 할 때 사용하는 환경설정 파일로, 접근 시 ~ 사용
  2. 사용자 홈 디렉터리 내에 이 디렉터리 생성하고, index.html 등 문서를 위치 시켜야 함
  3. <Directory /home/*/public_html>
		AllowOverride FileInfo AuthConfig Limit Indexes
		Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
		Require method GET POST OPTIONS
    </Directory>
다. httpd-vhosts.conf
  1. IP 주소 하나에 여러 도메인을 사용하는 버추얼 호스트를 설정할 때 사용
  2. 기본 구성(도메인 하나 당)
	<VirtualHost *:80>
		세부설정은 같음
	</VirtualHOST>
라. .htaccess 지시자
  1. AuthType Basic
  2. AuthName "Admin Login"
  3. AuthUserFile /etc/password
  4. Require valid-user
마. httpd-multilang-errordoc.conf
  1. 에러 상황에 따라 제공되는 문서 설정 파일
  2. ErrorDocument라는 환경설정으로 해당 에러 번호에 맞는 페이지 제공
	ㄱ. 400: Bad Request
	ㄴ. 401: Unauthorized
	ㄴ. 403: Forbideen
	ㄷ. 404: Not Found
	ㄹ. 502: Bad GateWay
바. 아파치 명령어
  1. httpd
	ㄱ. httpd &
	   - 아파치 구동
	ㄴ. httpd -t
	   - httpd.conf 파일 문법적 오류 검사
	ㄷ. httpd -l
	   - 컴파일 된 모듈 출력
	ㄹ. httpd -S 가상 호스트 정보 출력
  2. apachectl
	ㄱ. systemctl 사용법과 유사
	   - apachectl (start|stop|restart)	
	ㄴ. apachectl configtest
	   - httpd.conf 문법 오류 검사
	ㄷ. apachctl graceful
	   - 접속 끊지 않고 환경 설정파일 다시 읽음
사. 사용자 인증
  1. 설정 절차
	ㄱ. 사용자 생성 및 사용자 계정 파일 생성
	   - htpasswd -c /etc/password posein
	ㄴ. httpd.conf 파일에 인증할 디렉터리 관련 설정
	   - <Directory "/usr/local/apache/htdocs/admin">
			AllowOverride AuthConfig
	     </Directory>
	ㄷ. .htaccess 파일 생성
	   - vim /usr/local/apache/htdocs/admin/.htaccess
		# AuthType Basic
		# AuthName "Admin Login"
		# AuthUserFile /etc/password
		# Require valid-user
■ NIS 짧막하게 중요한거
가. NIS 도메인명 설정
  1. nisdomainname test.co.kr
  2. vim /etc/sysconfig/network
	# cat /etc/sysconfig/network
	# NISDOMAIN=test.co.kr
■ Samba 서버 관리
가. 개요: 다른 시스템의 디스크나 프린터 등 자원 공유할 수 있는 도구(TCP/IP)
나. 데몬
  1. smbd
  2. nmbd
다. 서버 설정
  1. /etc/samba/smb.conf
	ㄱ. 주요 섹션
	   - [global]
		# workgroup = SAMBA
		   - 공유 그룹명 지정
		# server string = Samba Server
		   - 서버 설명 설정	
		# netbios name = MYSERVER
		   - 윈도우에서 이름으로 접속할 때 관련 이름 지정
		# interfaces = lo eth0 192.168.50.2/24 192.168.51.2/24
		   - 네트워크 인터페이스 별로 접근 제어할 때 설정
		# hosts allow = 127. 192.168.12. 192.168.13 EXCEPT(제외) 192.168.51.3
		   - 호스트 설정
		# security = user
		   - 사용자명 패스워드 입력하여 인증
	   - [homes]
	   - [printers]
  2..명령어
	ㄱ. smbclient [option] HOST
	   - 리눅스에서 윈도우 서버로 접근
		# smbclient -L joon -U administrator%1234(p/w)
		   - joon이라는 호스트에 administrator 계정으로 접근하여 공유 목록 확인
		# smbclient \\\\joon\\source -U administrator
		   - joon 호스트의 source에 administrator 계정으로 접근
	ㄴ. smbstatus
	   - 클라이언트와 연결된 상태 출력
	ㄷ. testparm
	   - 현재 서버의 smb.conf 설정 확인
	ㄹ. nmblookup
	   - WINS(window) 서버에 질의
	ㅁ. mount.cifs
	   - mount.cifs \\공유서버\디렉터리 \디렉터리
	ㅅ. smbpasswd
	   - 사용자 생성 및 삭제, p/w 변경, 활성화 등 정보 변경
■ NFS 서버 관리
가. 환경설정 파일
  1. /etc/exportfs 설정, 해당 파일에서 특정 디렉토리에 rw 옵션을 지정하면 실제로도 지정해야함
  2. 설정방법
	ㄱ. 공유할 디렉토리   허가할 호스트(옵션)   [허가할 호스트(옵션) ...]
	ㄴ. /nfsdata	192.168.5.13
	   /nfsdata1	192.168.5.0/255.255.255.0(rw,root_squash)
	   /nfsdata2	192.168.12.0/24(rw,no_root_squash)
	ㄷ. 주요 옵션
	   - root_squash: NFS 클라에서 root 사용자 무시하고 nobody로 매핑시키며 일반사용자 권한 인정
	   - no_root_squash: root 무시하지 않고 root로 인정
	   - all_squash: 모든 사용자의 권한을 nobody로 매핑시킴
	ㄹ. 마운트 방법 
	   - mount -t nfs 192.168.5.13:/nfsdata /mnt
	   - mount.nfs 192.168.5.13:nfsdata /mnt
	ㅁ. fstab 등록
	   - 192.168.5.13:/nfsdata	/mnt	nfs	timeo=15,soft,retrans=3	0 0
  3. exportfs
	ㄱ. NFS 서버에 export 된 디렉토리 정보 관리
	   - exportfs
		# /etc/exportfs에 설정된 내용 간단히 출력
         - exfortfs -v (자세히 출력)
	   - exportfs -r /etc/exportfs에 설정된 내용 다시 읽어들여서 출력
	   - exportfs -au 익스포트된 디렉토리 모두 해제
  4. showmount
	ㄱ. 익스포트 마운트한 클라이언트 목록 출력
	ㄴ. -e (host/ip) 옵션: 익스포트된 정보 출력
  5. nfsstat
	ㄱ. NFS 상태 출력
■ FTP 서버 관리
가. 개요: TCP/IP 기반 서버<->클라이언트 파일 주고받는 도구
나. vsftpd 서버 설정
  1. 주요 파일
	ㄱ. /etc/vsftpd/vsftpd.conf
	   - 주요 설정
		# anonymous_enable=yes
		   - 익명 계정 허가 유무 설정
		# local_enable
		   - 로컬 사용자 허용
		# local_umask=022
		   - 생성 시 퍼미션 값 지정
		# anon_mkdir_write_enable=YES
		   - 익명 사용자 디렉토리 생성 가능
		# anon_upload_enable=YES
		   - 익명 사용자 업로드 가능
		# userlist_enable=YES
		# userlist_deny=YES
		   - user_list 파일 사용 시
		   - enable, deny가 YES면 user_list에 등록된 사용자만 사용 몬함
		   - enable YES, deny NO면 user_list에 등록된 사용자만 사용 가능
		# chroot_local_user=YES
		   - 접속한 사용자의 홈 디렉토리를 최상위 디렉토리로 지정
  2. 사용자 제한 설정 중요 파일
	ㄱ. /etc/vsftpd/user_list
	   - 한 줄에 한 계정씩 나열하면 됨
■ 센드메일
가. 개요
  1. 주요 환경파일
	ㄱ. /etc/mail/sendmail.cf
	   - Cwlocalhost
		# 도메인명 기입
	   - Fw/etc/mail/local-host-names
		# 여러 도메인 사용 시 별도의 파일 지정
	   - DJposein.org
		# 특정 도메인 명으로 지정하여 강제적으로 적용 ->발신 도메인이 posein.org로 강제적용
	   - O AliasFile=/etc/aliases
		# 특정 계정으로 메일 도착 시 다른 계정으로 메일 전송
	ㄴ. /etc/mail/local-host-names
	   - 메일 서버에 사용하는 도메인 설정하는 파일로, 한 줄에 하나씩 기입
	ㄷ. /etc/mail/access
	   - 메일서버로 접근하는 호스트나 도메인 접근 제어
		# 통과 RELAY / 거부 REJECT or DISCARD
		# From:spammer@aol.com		REJECT
		# TO:posein.org			RELAY
		# Connect:posein.org		RELAY
	   - 변경 시 makemap hash 명령을 이용하여 업데이트 해야 함
		# makemap hash /etc/mail/access < /etc/mail/access
	ㄹ. /etc/mail/aliases
	   - 특정 계정으로 들어오는 메일을 다른 계정으로 전송
		# vim /etc/aliases
		   - webmaster:	posein, yuloje, jalin, joon, posein@naver.com
		   - admin::include:/etc/mail/admgroup
		# sendmail -l
	*sendmail.cf 파일 내용 변경 시 데몬 재시작하지만, 다른 파일은 별도의 db 파일로 변환
	ㅁ. /etc/mail/sendmail.mc
	   - sendmail 매크로 설정파일, sendmail.cf 파일 복원할 때 사용
		# m4 /etc/mail/sendmail.mc > /etc/mail/sendmail.cf
	ㅂ. /etc/mail/virtusertable
	   - 하나의 메일 서버에 여러 도메인 사용환경에서 동일한 메일 계정 요구
		# vim /etc/mail/virtusertable
		   - ceo@linnux.com	posein
		   - ceo@windows.com	yuloje
		   - @posein.org		posein@naver.com
			# 저것들을 다 뒤에 놈으로 전달
		# makemap hash /etc/mail/virtusertable < /etc/mail/virtusertable
	ㅅ. ~/.forward
	   - 사용자 개인이 자신에게 들어오는 메일을 다른 메일 주소로 포워딩 할 때 사용, 해당 사용자에게만 권한이 있어야 함
		# vim .forward
			posein@naver.com
■ DNS 관리
가. 서버 종류
  1. Primary Namer Server
	ㄱ. 도메인 관리 위한 필수 서버, Master DNS라고 부름, 이 서버의 IP 주소 등록
  2. Secondary Name server
	ㄱ. Master의 zone 파일 백업하는 역할 수행
  3. Caching Name server
	ㄱ. resolving만 제공하는 서버
나. 환경 파일
  1. /etc/named.conf
	ㄱ. DNS 서버의 전반적 환경설정 담당, zone 파일 지정
  2. /var/named
	ㄱ. 사용자학 선언하는 zone 파일 등이 위치
  3. zone 파일
	ㄱ. 지정된 경로에 포맷 생성, 호스트명 지정, 2차 도메인 부여 등 도메인 정보 담고있음
다. /etc/named.conf 파일
  1. 주요 구문
	ㄱ. options 구문
	   - listen-on port 53 { 127.0.0.1; };
		# 기본 값은 로컬 호스트만 접근 가능, 다른 호스트 접근 가능하게 하려면 주석
	   - directory "/var/named";
		# zone file 위치 디렉토리 명기
	   - forwarders { 네임서버주소1; 네임서버주소2;...};
		# 도메인에 대한 질의를 다른 서버로 넘길 때 사용
	   - forward (only|first);
		# forwarders 옵션과 함께 사용, only는 자신에게 들어온 도메인 질의를 다른 서버로 책임전가함, first는 다른 서버에서 응답 없으면 내가 답해줌
	   - allow-query { 192.168.0/24; };
		# 네임 서버에 질의할 수 있는 호스트 지정
	   - allow-transfer { 192.168.0/24; };
		# zone 파일의 내용을 복사할 대상에 제한을 걸 때 지정, 없으면 제한 없이 zone 파일 복사 가능하지만, 설정되어있으면 해당 호스트만 zone 파일 복사가능
	ㄴ. acl 구문
	   - 여러 호스트를 하나의 명칭으로 지정할 때 사용
	   - option 구문 이전에 선언해야함
	   - 사용 예
		# acl "member" { 210.96.52.100; 203.247.40/24 211.58.96.100; };
		# option {
				.
				.
				.
			}
		# zone "." IN {
 	
	ㄷ. zone 구문
	   - zone 파일 지정
	   - 원래는 /etc/named.conf에 저장 됐지만 복잡성을 막기 위해 /etc/named.rfc1912.zones 에서 설정하도로 꿘장 중임. 해서, 이 파일에 존이랑 리버스 존 설정해주면 됨.
	   - zone: 도메인에 대한 질의 시 IP를 알려줌
	   - 리버스 zone: zone의 반대
	   - reverse zone을 사용하지 않으면 IP 주소에 대한 질의가 되지 않음.
	   - 기본 형식
		#zone
		zone "도메인명“ IN {
			type (master | slave | hint);
			file "존파일명”;
		};
		# zone에는 도메인 이름을 기재
		# 리버스 존이면 ip 마지막 주소를 제외하고 거꾸로 나열 하고, 마지막에 in-addr.arpa라는 문자를 추가해줌
		   ex) 203.247.50.15
		   - zone "50.247.203.15.-in-addr.arpa"
		   - zone "50.247.203.in-addr.arpa" 이런 식으로
		# type
		   - DNS 서버 종류 나타냄, master는 primary, slave는 secondary, hint는 리졸빙을 위한 root zone 서버를 나타냄
		# file
		   - 사용하려고 하는 존 파일명 기재
		   - 존 파일
			# file "linux.zone";
		   - 리버스 존 파일
			# file 'linux.rev";
		# 설정 예시
		   zone "linux.or.kr" IN {
			type master;
			file "linux.zone";
		   };

		   zone "2.0.10.in-addr.arpa" IN {
			type master;
			file "linux.rev";
		   }
라. zone 파일 구조
  1. 기본 구조	
	$TTL	1D
	@ IN SOA nameserver contact-email-address {
		serial_num		; serial
		refresh_number		; refresh
		retry_number		; retry
		expire_number		; expire
		minimum_number  )	; minimum
	도메인	TTL  class  type		Rdata
	   - $TTL
		# 다른 서버에서 도메인 정보를 가져갔을 때, 해당 서버의 캐시에 해당 정보를 얼마나 가지고 있을지 결정, 86400 or 1D: 1일
	   - SOA record
		# namserver: 네임 서버의 호스트명과 도메이명 기재, 전체 도메인으로 기입할 시 마지막에 . 찍어야 함, ns.linux.or.kr.
	   	# contact_email_address: 관리자 이메일 주소 기재, posein.linux.or.kr.
	   - serial_num: 일련번호
	   - refresh_number; 보조네임서버가 정보 업데이트를 위해 네임서버에 체크하는 주기
	   - retry_number: 보조네임서버가 주네임서버에 접근 실패 시 재시도 주기
	   - expire_number: 네임서버에 접근 실패, 재시도 주기
	   - minumum_number: SOA 영역의 TTL, 가져간 정보의 최소 보관 시간 설정
	   - 도메인: @는 현재 도메인, 공백은 위에서 설정한 도메인
	   - type:
		# A: IPv4 주소 기입
		# AAAA: IPv6 주소 기입
		# NS: DNS 지정 시 사용
		# MX: 메일 서버를 지정할 때 사용, 0 or 양수 기입하여 우선순위 설정
		# PTR: 리버스 존에서만 사용하는 레코드, IP 주소를 도메인으로 변환
마. DNS 서버 설정 확인
  1. etc/resolv.conf 파일 변경 후 조회
	ㄱ. cat /etc/resolv.conf 
	   nameserver 10.0.2.15
	ㄴ. nslookup www.linux.or.kr
	   Server:	10.0.2.15
	   Address: 	10.0.2.15#53

	   Name:    www.linux.or.kr
	   Address:    10.0.2.15
  2. nslookup
	server IP
	도메인
바. DNS 유틸리티
  1. named-checkconf named.conf: 파일 문법적 오류 검사
  2. named-checkzone domain zone_file경로: zone 파일 문법적 오류 검사
■ 슈퍼데몬 관리
가. TCP Wrapper
  1. 개요: tcpd라는 데몬이 슈퍼 데몬인 inetd에 의하여 수행되는 서비스들의 접근을 제어
	    TCP 연결을 기반으로 하고, telnet, ftp, rlogin, rsh 등 감시하고 필터링
  2. 접근 호스트 목록 파일
	ㄱ. /etc/hosts.allow
	   - hosts.deny보다 빨리 읽으며, 이 안에 등록된 호스트는 무조건 적용
	ㄴ. /etc/hosts.deny
	   - hosts.allow보다 늦게 읽으며, hosts.deny에 등록되어 있지만, allow에도 등록되어 있으면 무조건 allow에 등록된 호스트를 허용
  3. 형식
	daemon_list : client_list [ : sheel_command]
	ㄱ. daemon_list
	   - 한 개 이상의 데몬프로세스를 쓰며, 서비스명 말고 실행 데몬명 작성하고 ‘,’로 구분
	   - ALL : ALL
	ㄴ. client_list
	   - 한 개 이상의 호스트, 주소, 패턴 작성, 일반적으로 IP 주소, 도메인 기입
	   - 표현 예
		# 192.168.1.
	 	# 192.168.1.0/255.255.255.0
	 	# .example.com
	   - ALL : localhost, .posein.org
	     in.telnetd : 192.168.5.13
	     in.telnetd@192.168.1.254: 192.168.1.
	     sshd : .posein.com EXECPT cracker.posein.com
	     ALL EXCEPT vsftpd : .ihd.or.kr EXCEPT bad.ihd.or.kr
나. xinetd
  1. 개요: inetd 대체하며, TCP wrapper 같은거 필요 없이 자체적으로 접근제어 가능
	     IP 주소당 접속 수 제한, 시간대별 서비스 제한, DoS 공격 대비 설정 추가 제공
  2. 구성 요소
	ㄱ. /etc/xinetd.conf
	   - 전체 서비스 환경설정
	ㄴ. /etc/xinetd.d
	   - 해당 데몬에 의해 관리되는 서비스 파일 위치
  3. /etc/xinetd.conf
	defaults
	{
		log_type		= SYSLOG daemon info
		log_on_failure	= HOST
		log_on_success	= PID HOST DURATION EXIT
		cps		= 50 10
		instances		= 50
		per_source	= 10
		v6only		= no
		groups		= yes
		umask		= 002
	}
	includedir /etc/xinetd.d
	   - log_type
		# 로그 저장 형태 지정, SYSLOG, FILE 두 가지 설정 가능
	   - cpus
		# 초당 요청 받은 수에 대한 제한 설정
		# cpu	= 50 10
		   - 초당 요청 수가 50개 이상일 경우 10초동안 연결 중단
	   - instances
		# xinetd가 생성하는 관련 데몬 최대 개수 지정
	   - per_source
		# 같은 IP 주소로 접속할 수 있는 서비스 수 제한
	   - only_from
		# 접속 허가할 호스트 IP 설정
	   - enable
		# 사용 가능한 서비스 지정
	   - disable
		# 반대
  4. /etc/xinetd.d/telnet
	ㄱ. vim /etc/xinetd/telnet
	service telnet
	{
		disable		= no
		flags		= REUSE
		socket_type	= stream
		wait		= no
		user		= root
		server		= /usr/sbin/in.telnetd
		log_on_failure	+= USERID
	}
	   - disable	= no
		# 서비스 실행 유무 지정, no면 사용 yes면 사용 안함
	   - flags	= REUSE
		# 계속적으로 재사용
	   - socket_type	= stream
		# 네트워크 소켓 타입 지정
	   - wait		= no
		# 서비스가 단일 스레드인지 다중 스레드를 결정하는 항목, yes 면 단일 스레드
	   - user		= root
		# 서버 프로세스 UID 지정
	   - server	= /usr/sbin/in.telnetd
		# 해당 서비스 실행 데몬 파일 경로 지정
	   - log_on_failure += USERID
		# 로그 관련 설정
■ dhcp 서버 관리
가. 개요: 자동으로 클라이언트에게 IP, Gateway, Name server 주소 할당해주는 서버
나. 환경설정파일
  1. /etc/dhcp/dhcpd.conf
	ㄱ. /usr/share/doc/dhcp-*/dhcpd.conf.example 파일 복사해서 사용
다. 주요 설정
  1. 클라이언트에게 할당할 주소 대역은 subnet, netmask 선언 후 { } 안에 필요한 항목 지정
  2. 설정 방법
  subnet 192.168.1.0 netmask 255.255.255.0 {
	range 192.168.1.2 192.168.1.254;
	option domain-name "posein.org"
	option domain-name-server ns1.posein.org
	option routers 192.168.1.1;
	option broadcast-address 192.168.1.255;
	default-lease-time 600;  # IP 임대 만료시간
	max-lease-time 7200;   # IP 주소를 가지고 있을 수 있는 최대 시간
  } 
■ iptables
가. Table
  1. filter
	ㄱ. 패킷 필터링 담당
	ㄴ. 패킷 필터링, 방화벽 구성은 filter의 3개 사슬에 정책 설정
	ㄷ. 다수의 서버 관리 시 사용
  2. nat (network address translation)
	ㄱ. IP 주소 변환
	ㄴ. 하나의 공인 IP 주소를 가지고 여러 대의 컴퓨터나 서버 운영할 때 사용
	ㄷ. 다수의 서버 관리 시 사용
  3. mangle
	ㄷ. 패킷 데이터를 변경하는 특수 규칙을 적용
	ㄴ. TOS(type of service) 설정
  4. raw
	ㄱ. 넷필터의 연결추적 하위 시스템과 독립적으로 동작하는 규칙을 설정
  5. security
	ㄱ. SELinux에 의해 사용되는 MAC 네트워크 관련 규칙 적용
나. chain(필터와 nat에서 사용되는)
  1. INPUT
	ㄱ. 패킷 필터링 및 방화벽 관련 정책 설정, 실제적인 접근 통제 담당, 패킷에 적용
  2. FORWARD
	ㄴ. 다른 시스템으로의 접근 차단, 리눅스 자체가 생성하는 패킷 제어
  3. OUTPUT
	ㄷ. 리눅스를 통과하는 패킷 관리, 한 네트워크를 다른 네트워크와 연결하기 위해 두 네트워크 간 패킷이 방화벽을 통과하는 경우, 하나의 IP를 여러 대의 사설 IP를 사용하는 시스템 접근제어 정책 설정
  4. PREROUTING
  5. POSTROUTING
다. 사용방법
  1. iptables [-t table] action chain match [-j target]
	ㄱ. 테이블의 기본 설정은 filter
	ㄴ. action은 사슬 지정, 설정, 제어 시 사용 주로 -N, -A 옵션 사용
	ㄷ. chain은 INPUT, OUTPUT 입력
	ㄹ. match는 실질적인 매치 지정, -d, -p 옵션 사용
	ㅁ. target은 실질적인 타깃 지정, -j 옵션 사용하여 설정
  2. 주요 액션
	ㄱ. -N: 사용자 정의 사슬 생성
	ㄴ. -X: 비어있는 사슬 제거, 비어있는 사슬 제거 불가
	ㄷ. -P: 사슬 기본 정책 설정
	ㄹ. -L: 현재 사슬 규칙 나열
	ㅁ. -F: 사슬 규칙 제거
	ㅂ. -A: 사슬 규칙 추가, 해당 사슬의 맨 마지막 규칙으로 등록
	ㅅ. -I: 규칙 맨 앞에 삽입
	ㅇ. -R: 사슬 규칙 교환
	ㅈ. -D: 사슬 규칙 제거
  3. 주요 매치
	ㄱ. -s: 출발지 IP 주소나 네트워크 매칭하고, 도메인, IP, 넷마스크값을 이용하여 표기
	ㄴ. -d: 목적지 IP 주소나 네트워크 매칭하고, 도메인, IP, 넷마스크값을 이용하여 표기
	ㄷ. -p: 특정 프로토콜과 매칭, TCP, UDP, ICMP와 같은 이름 사용
	ㄹ. -i: 입력 인터페이스와 매칭
	ㅁ. -o: 출력 인터패이스와 매칭
	ㅂ. -m: 세밀하게 제어할 때 사용
  4. 기타 옵션
	ㄱ. --line-number: 정책 앞에 번호 붙여 출력하여, 삭제나 삽입 시 유용
	ㄴ. -n: 숫자로 표시
	ㄷ. -v: 패킷, 바이트 추가하여 자세히 출력
  5. 주요 타깃
	ㄱ. ACCEPT: 패킷 허가
	ㄴ. DROP: 패킷 거부
	ㄷ. LOG: 패킷을 syslog에 전달하여 기록
	ㄹ. REJECT: 패킷 버리고 적당한 응답 패킷 전달
	ㅁ. RETURN: 호출 사슬 내에서 패킷 처리 계속 진행
  6. 사용 예
	ㄱ. iptables -nL
	ㄴ. iptables -L INPUT
	ㄷ. iptables -A INPUT -s 192.168.1.0/24 -j ACCEPT
	   - INPUT 사슬에 발신지가 192.168.0 대역 호스트 허가 정책 추가
	ㄹ. iptables -A INPUT -s 192.168.5.13 -p icmp -j DROP (p 앞에 ! 붙으면 icmp 제외 패킷)
	   - INPUT 사슬에 192.168.5.13의 icmp 패킷 접근 거부 정책 추가
	ㅁ. iptables -DINPUT 2
	ㅂ. iptables -A OUTPUT -p tcp -d www.posein.org --dport 80 -o eth0 -j DROP
	   - 해당 웹사이트 차단
	ㅂ. iptables -A FORWARD -p tcp -d www.posein.org --dport 80 -o eth0 -j DROP
	   - 공인 IP 주소 공유하여 SNAT 설정 시 사설 IP 대역 사용자 웹사이트 접속 차단
라. 설정한 규칙 저장
  1. iptables 명령으로 설정한 정책은 재부팅 시 초기화됨, 따라서 저장해야 함.
  2. 명령어 사용하여 저장
	ㄱ. iptables-save
	   - iptables 설정된 정책을 출력해줌
	   - -t (nat): nat 설정 정책 출력
	   - iptables > firewall.sh
	ㄴ. iptables-restore [option]
	   - 정책 설정 반영하는 명령으로, iptables-save에서 저장한 파일로 정책 저장
	   - iptables-restore > firewall.sh
마. iptables로 nat 설정
  1. SNAT(Source NAT)
	ㄱ. 공인 IP 주소 하나로 다수의 컴퓨터가 인터넷 접속 가능케 하는 경우 사용
	ㄴ. 라우팅 경로가 결정된 이후에 설정하여 NAT 테이블의 POSTROUTING에 정책 설정
	ㄷ. 설정 예
	   - iptables -t nat -A POSTROUTING -o etho0 -j SNAT --to 203.247.50.3
		# eth0 장치를 통해 나가는 패킷에 203.247.50.3 주소 부여
	   - iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to 203.247.50.3-203.247.50.7
		# eth0 장치를 통해 나가는 패킷에 해당 번호 사이의 주소 부여
	   - iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
		# MASQUERADE는 유동 IP 주소 사용하는 경우 부여
  2. DNAT(Destination NAT)
	ㄱ. 공인 IP 주소 하나로 다수 서버 운영하는 경우 사용
	ㄴ. routing 이전 단계에서 적용되어 PREROUTING에 정책 설정
	ㄷ. 설정 예
	   - iptables -A PREROUTING -t nat -p tcp -d 203.247.50.3 --dport 80 -J DNAT --to 192.168.1.11:80
		# 목적지 주소 203.247.50.3의 80번 포트인 경우에 뒤에 주소로 연결

■ firewalld
가. 개요: 
  1. iptables 설정 유틸리티이며, D-BUS(desktop bus) 인터페이스가 있는 데몬
  2. iptables에서는 런타임 구성, 영구 구성 설정이 분리되어 있지 않음. firewalld는 가능
  3. firewall-cmd로 정책 설정할 수 있으나, reload, restart, 재부팅을 수행하면 설정은 사라짐
나. 영구 설정 방법
  1. 명령어
	ㄱ. firewall-cmd
  2. 사용법
	ㄱ. 런타임 영구 설정
	   - firewall-cmd --zone=public --add-service=https
	   - firewall-cmd --permanent --zone=public -add-service=https
	ㄴ. 서비스 시간 설정
	   - firewall-cmd -add-serice=ssh --timeout 15m
